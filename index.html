<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yol BilgisayarÄ±</title>
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <style>
    :root[data-theme="dark"] {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #ffffff;
      --accent: #4caf50;
      --input-bg: #2a2a2a;
    }
    :root[data-theme="light"] {
      --bg: #ffffff;
      --card: #f1f1f1;
      --text: #000000;
      --accent: #0d6efd;
      --input-bg: #ffffff;
    }
    body {
      background-color: var(--bg);
      color: var(--text);
    }
    .fade-in {opacity: 0; transition: opacity .4s;}
  </style>
</head>
<body>
  <div class="d-flex justify-content-between mb-3">
    <button id="themeBtn" class="btn btn-secondary">ğŸŒ™</button>
    <button id="langBtn" class="btn btn-secondary">EN</button>
  </div>

  <div class="container my-3">
    <h2 class="text-center mb-3">Yol BilgisayarÄ±</h2>
    <div class="mb-3">
      <label for="model" class="form-label">AraÃ§ Modeli</label>
      <select id="model" class="form-select"></select>
    </div>
    <div class="mb-3">
      <label for="tuketim" class="form-label">100 km'de tÃ¼ketim (L)</label>
      <input type="number" inputmode="decimal" step="0.1" id="tuketim" class="form-control" placeholder="Ã–rn: 6.5">
      <div class="invalid-feedback">LÃ¼tfen bu alanÄ± doldurun.</div>
    </div>
    <div class="mb-3">
      <label for="fiyat" class="form-label">YakÄ±t FiyatÄ± (TL/L)</label>
      <input type="number" inputmode="decimal" step="0.1" id="fiyat" class="form-control" placeholder="Ã–rn: 40">
      <div class="invalid-feedback">LÃ¼tfen bu alanÄ± doldurun.</div>
    </div>
    <div class="mb-3">
      <label for="mesafe" class="form-label">Mesafe (km)</label>
      <input type="number" inputmode="decimal" step="0.1" id="mesafe" class="form-control" placeholder="Ã–rn: 350">
      <div class="invalid-feedback">LÃ¼tfen bu alanÄ± doldurun.</div>
    </div>
    <div class="mb-3">
      <label for="yolcu" class="form-label">Yolcu SayÄ±sÄ±</label>
      <input type="number" inputmode="decimal" step="0.1" id="yolcu" class="form-control" value="1">
      <div class="invalid-feedback">LÃ¼tfen bu alanÄ± doldurun.</div>
    </div>
    <button id="calcBtn" class="btn btn-primary w-100">Hesapla</button>
    <div id="sonuc" class="mt-3 p-3 border rounded fade-in">SonuÃ§ burada gÃ¶rÃ¼necek</div>
    <button id="downloadBtn" class="btn btn-secondary w-100 mt-3">Verilerimi Ä°ndir</button>
    <canvas id="historyChart" class="mt-3"></canvas>
  </div>

  <div class="container my-3">
    <h2 class="text-center mb-3">AraÃ§ Bilgileri</h2>
    <div class="mb-3">
      <label for="lastikTarihi" class="form-label">Lastik DeÄŸiÅŸim Tarihi</label>
      <input type="date" id="lastikTarihi" class="form-control">
    </div>
    <div class="mb-3">
      <label for="lastikKm" class="form-label">Lastik DeÄŸiÅŸim Kilometresi</label>
      <input type="number" inputmode="decimal" step="0.1" id="lastikKm" class="form-control">
    </div>
    <div class="mb-3">
      <label for="bakimTarihi" class="form-label">BakÄ±m Tarihi</label>
      <input type="date" id="bakimTarihi" class="form-control">
    </div>
    <button id="saveVehicle" class="btn btn-primary w-100">Kaydet</button>
    <div id="aracBilgiSonuc" class="mt-3 p-3 border rounded">Bilgiler burada gÃ¶rÃ¼necek</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const langData = {
      tr:{
        calc:'Hesapla',
        result:'SonuÃ§ burada gÃ¶rÃ¼necek',
        vehicleInfo:'AraÃ§ Bilgileri',
        download:'Verilerimi Ä°ndir'
      },
      en:{
        calc:'Calculate',
        result:'Result will appear here',
        vehicleInfo:'Vehicle Info',
        download:'Download Data'
      }
    };

    const inputs=['tuketim','fiyat','mesafe','yolcu'];
    const historyKey='gecmisHesap';
    const vehicleKey='araclar';
    const formKey='formData';
    const themeKey='theme';
    const langKey='lang';

    function init(){
      loadTheme();
      loadLang();
      loadVehicles();
      loadFormData();
      gosterAracBilgileri();
      renderChart();
    }

    function loadTheme(){
      const saved=localStorage.getItem(themeKey)||'dark';
      document.documentElement.setAttribute('data-theme',saved);
      document.getElementById('themeBtn').textContent=saved==='dark'?'â˜€ï¸':'ğŸŒ™';
    }

    function toggleTheme(){
      const current=document.documentElement.getAttribute('data-theme')==='dark'?'dark':'light';
      const next=current==='dark'?'light':'dark';
      document.documentElement.setAttribute('data-theme',next);
      localStorage.setItem(themeKey,next);
      document.getElementById('themeBtn').textContent=next==='dark'?'â˜€ï¸':'ğŸŒ™';
    }

    function loadLang(){
      const current=localStorage.getItem(langKey)||'tr';
      setLang(current);
    }

    function setLang(lng){
      localStorage.setItem(langKey,lng);
      document.getElementById('calcBtn').textContent=langData[lng].calc;
      document.getElementById('downloadBtn').textContent=langData[lng].download;
      document.querySelectorAll('h2')[1].textContent=langData[lng].vehicleInfo;
      document.getElementById('langBtn').textContent=lng==='tr'?'EN':'TR';
    }

    function toggleLang(){
      const current=localStorage.getItem(langKey)||'tr';
      setLang(current==='tr'?'en':'tr');
    }

    function saveFormData(){
      const data={};
      inputs.forEach(id=>data[id]=document.getElementById(id).value);
      localStorage.setItem(formKey,JSON.stringify(data));
    }

    function loadFormData(){
      const data=localStorage.getItem(formKey);
      if(data){
        const obj=JSON.parse(data);
        inputs.forEach(id=>{
          if(obj[id]) document.getElementById(id).value=obj[id];
        });
      }
    }

    function hesapla(){
      let valid=true;
      inputs.forEach(id=>{
        const el=document.getElementById(id);
        if(!el.value){
          el.classList.add('is-invalid');
          valid=false;
        }else{
          el.classList.remove('is-invalid');
        }
      });
      if(!valid) return;

      const tuketim=parseFloat(tuketim.value);
      const fiyat=parseFloat(fiyat.value);
      const mesafe=parseFloat(mesafe.value);
      const yolcu=parseFloat(yolcu.value)||1;

      const toplamLitre=(tuketim*mesafe)/100;
      const toplamTutar=toplamLitre*fiyat;
      const kisiBasi=toplamTutar/yolcu;
      const co2=toplamLitre*2.31;

      const sonucEl=document.getElementById('sonuc');
      sonucEl.style.opacity=0;
      sonucEl.innerHTML=`ğŸ”¹ TÃ¼ketim: <strong>${toplamLitre.toFixed(2)} L</strong><br>ğŸ”¸ Maliyet: <strong>${toplamTutar.toFixed(2)} TL</strong><br>ğŸ‘¥ KiÅŸi BaÅŸÄ±: <strong>${kisiBasi.toFixed(2)} TL</strong><br>ğŸŒ â‰ˆ ${co2.toFixed(1)} kg COâ‚‚`;
      setTimeout(()=>{sonucEl.style.opacity=1},10);

      saveHistory({tuketim, fiyat, mesafe, yolcu, toplamTutar, tarih:new Date().toISOString()});
      renderChart();
      saveFormData();
    }

    function saveHistory(item){
      const arr=JSON.parse(localStorage.getItem(historyKey)||'[]');
      arr.push(item);
      localStorage.setItem(historyKey,JSON.stringify(arr));
    }

    function downloadCSV(){
      const arr=JSON.parse(localStorage.getItem(historyKey)||'[]');
      if(!arr.length) return;
      const headers=['tuketim','fiyat','mesafe','yolcu','toplamTutar','tarih'];
      const rows=[headers.join(',')].concat(arr.map(o=>headers.map(h=>o[h]).join(',')));
      const blob=new Blob([rows.join('\n')],{type:'text/csv'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url;
      a.download='veriler.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function renderChart(){
      const arr=JSON.parse(localStorage.getItem(historyKey)||'[]');
      const ctx=document.getElementById('historyChart').getContext('2d');
      if(window.historyChart) window.historyChart.destroy();
      if(!arr.length) return;
      window.historyChart=new Chart(ctx,{
        type:'line',
        data:{
          labels:arr.map(a=>new Date(a.tarih).toLocaleDateString()),
          datasets:[{label:'Maliyet (TL)',data:arr.map(a=>a.toplamTutar),borderColor:'var(--accent)',tension:0.2}]},
        options:{scales:{y:{beginAtZero:true}}}
      });
    }

    function kaydetAracBilgileri(){
      const info={
        lastikTarihi:lastikTarihi.value,
        lastikKm:lastikKm.value,
        bakimTarihi:bakimTarihi.value
      };
      localStorage.setItem('aracBilgileri',JSON.stringify(info));
      gosterAracBilgileri();
    }

    function gosterAracBilgileri(){
      const container=document.getElementById('aracBilgiSonuc');
      const data=localStorage.getItem('aracBilgileri');
      if(data){
        const info=JSON.parse(data);
        container.innerHTML=`ğŸ”§ Lastik Tarihi: <strong>${info.lastikTarihi||'-'}</strong><br>ğŸ Lastik KM: <strong>${info.lastikKm||'-'}</strong><br>ğŸ”¨ BakÄ±m Tarihi: <strong>${info.bakimTarihi||'-'}</strong>`;
      }else{
        container.textContent='HenÃ¼z kayÄ±t yok.';
      }
    }

    function loadVehicles(){
      const select=document.getElementById('model');
      const stored=JSON.parse(localStorage.getItem(vehicleKey)||'[]');
      select.innerHTML='<option value="">SeÃ§iniz</option>';
      stored.forEach(v=>{
        const opt=document.createElement('option');
        opt.value=v.avg;
        opt.textContent=v.model;
        select.appendChild(opt);
      });
      select.addEventListener('change',()=>{
        if(select.value) document.getElementById('tuketim').value=select.value;
      });
    }

    document.getElementById('themeBtn').addEventListener('click',toggleTheme);
    document.getElementById('langBtn').addEventListener('click',toggleLang);
    document.getElementById('calcBtn').addEventListener('click',hesapla);
    document.getElementById('saveVehicle').addEventListener('click',kaydetAracBilgileri);
    document.getElementById('downloadBtn').addEventListener('click',downloadCSV);
    window.addEventListener('DOMContentLoaded',init);

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
