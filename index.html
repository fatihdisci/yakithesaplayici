<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yol Bilgisayarı</title>
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:1rem; background:#f5f5f5; color:#222; }
  h2 { margin-top:0; }
  .card { background:#fff; padding:1rem; margin-bottom:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,.1); }
  label { display:block; margin-top:.5rem; }
  input, select, button { width:100%; padding:.5rem; margin-top:.2rem; }
  table { width:100%; border-collapse:collapse; margin-top:.5rem; font-size:.9rem; }
  th, td { border:1px solid #ccc; padding:.4rem; text-align:left; }
  .flex { display:flex; gap:.5rem; }
</style>
</head>
<body>

<div class="card">
  <h2>Yakıt Hesabı</h2>
  <label>100 km'de tüketim (L): <input type="text" id="tuketim"></label>
  <label>Yakıt Fiyatı (TL/L): <input type="text" id="fiyat"></label>
  <label>Mesafe (km): <input type="text" id="mesafe"></label>
  <label>Yolcu Sayısı: <input type="number" id="yolcu" min="1" value="1"></label>
  <label>Araç: 
    <select id="modelSelect"></select>
  </label>
  <button id="hesaplaBtn">Hesapla</button>
  <div id="sonuc" style="margin-top:.5rem; font-weight:bold;"></div>
  <table id="historyTable">
    <thead><tr><th>Tarih</th><th>Model</th><th>Maliyet (TL)</th></tr></thead>
    <tbody></tbody>
  </table>
  <div class="flex">
    <button id="clearHistoryBtn">Geçmişi Temizle</button>
    <button id="exportBtn">Dışa Aktar</button>
    <input type="file" id="importFile" style="flex:1;">
  </div>
</div>

<div class="card">
  <h2>Araç Yönetimi</h2>
  <label>Yeni Araç Modeli: <input type="text" id="newModel"></label>
  <button id="addVehicleBtn">Araç Ekle</button>
  <hr>
  <label>Lastik Değişim Tarihi: <input type="date" id="lastikTarihi"></label>
  <label>Lastik Değişim KM: <input type="number" id="lastikKm"></label>
  <label>Akü Değişim Tarihi: <input type="date" id="akuTarihi"></label>
  <label>Bakım Tarihi: <input type="date" id="bakimTarihi"></label>
  <div class="flex">
    <button id="saveVehicleBtn">Kaydet/Güncelle</button>
    <button id="deleteVehicleBtn">Araç Sil</button>
  </div>
</div>

<script>
const VEH_KEY='yb_vehicles_v1', HIST_KEY='yb_history_v1', FORM_KEY='yb_form_v1';
const qs=id=>document.getElementById(id);

function normalize(val){ return parseFloat(String(val).replace(',','.')); }

function loadVehicles(){
  const list=JSON.parse(localStorage.getItem(VEH_KEY)||'[]');
  const sel=qs('modelSelect');
  sel.innerHTML='<option value="">Seçiniz</option>';
  list.forEach((v,i)=>{ 
    const opt=document.createElement('option'); 
    opt.value=i; opt.textContent=v.model; 
    sel.appendChild(opt); 
  });
}

function saveVehicle(){
  const idx=qs('modelSelect').value;
  if(idx===""){ alert("Araç seçiniz"); return; }
  const list=JSON.parse(localStorage.getItem(VEH_KEY)||'[]');
  list[idx].info={
    lastikTarihi:qs('lastikTarihi').value,
    lastikKm:qs('lastikKm').value,
    akuTarihi:qs('akuTarihi').value,
    bakimTarihi:qs('bakimTarihi').value
  };
  localStorage.setItem(VEH_KEY,JSON.stringify(list));
  alert("Kaydedildi");
}

function addVehicle(){
  const model=qs('newModel').value.trim();
  if(!model) return;
  const list=JSON.parse(localStorage.getItem(VEH_KEY)||'[]');
  list.push({model,info:{}});
  localStorage.setItem(VEH_KEY,JSON.stringify(list));
  qs('newModel').value="";
  loadVehicles();
}

function deleteVehicle(){
  const idx=qs('modelSelect').value;
  if(idx==="") return;
  const list=JSON.parse(localStorage.getItem(VEH_KEY)||'[]');
  list.splice(idx,1);
  localStorage.setItem(VEH_KEY,JSON.stringify(list));
  loadVehicles();
}

function hesapla(){
  const tuk=normalize(qs('tuketim').value);
  const fiyat=normalize(qs('fiyat').value);
  const mesafe=normalize(qs('mesafe').value);
  const yolcu=parseInt(qs('yolcu').value)||1;
  if(!(tuk>0&&fiyat>0&&mesafe>0)) return;
  const litre=(tuk*mesafe)/100;
  const tutar=litre*fiyat;
  const kisi=tutar/yolcu;
  const co2=litre*2.31;
  qs('sonuc').innerHTML=`Tüketim: ${litre.toFixed(2)} L | Maliyet: ${tutar.toFixed(2)} TL | Kişi Başı: ${kisi.toFixed(2)} TL | CO₂: ${co2.toFixed(1)} kg`;
  const list=JSON.parse(localStorage.getItem(HIST_KEY)||'[]');
  const modelSel=qs('modelSelect');
  const modelName=modelSel.value!=="" ? JSON.parse(localStorage.getItem(VEH_KEY)||'[]')[modelSel.value].model : "";
  list.push({tarih:new Date().toLocaleString(), model:modelName, toplamTutar:tutar});
  localStorage.setItem(HIST_KEY,JSON.stringify(list));
  renderHistory();
}

function renderHistory(){
  const list=JSON.parse(localStorage.getItem(HIST_KEY)||'[]');
  const tbody=qs('historyTable').querySelector('tbody');
  tbody.innerHTML="";
  list.forEach(row=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${row.tarih}</td><td>${row.model}</td><td>${row.toplamTutar.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
}

function clearHistory(){
  localStorage.removeItem(HIST_KEY);
  renderHistory();
}

function exportData(){
  const data={
    vehicles:JSON.parse(localStorage.getItem(VEH_KEY)||'[]'),
    history:JSON.parse(localStorage.getItem(HIST_KEY)||'[]')
  };
  const blob=new Blob([JSON.stringify(data)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download="yol-bilgisayari.json";
  a.click();
}

function importData(file){
  const reader=new FileReader();
  reader.onload=()=>{
    try{
      const obj=JSON.parse(reader.result);
      if(confirm("Mevcut verilerin üzerine yazılacak. Onaylıyor musunuz?")){
        if(obj.vehicles) localStorage.setItem(VEH_KEY,JSON.stringify(obj.vehicles));
        if(obj.history) localStorage.setItem(HIST_KEY,JSON.stringify(obj.history));
        loadVehicles();
        renderHistory();
      }
    }catch(e){alert("Geçersiz dosya");}
  };
  reader.readAsText(file);
}

// Olaylar
qs('hesaplaBtn').onclick=hesapla;
qs('clearHistoryBtn').onclick=clearHistory;
qs('exportBtn').onclick=exportData;
qs('importFile').onchange=e=>{ if(e.target.files[0]) importData(e.target.files[0]); };
qs('addVehicleBtn').onclick=addVehicle;
qs('saveVehicleBtn').onclick=saveVehicle;
qs('deleteVehicleBtn').onclick=deleteVehicle;

// Başlangıç
loadVehicles();
renderHistory();
</script>
</body>
</html>
